{% extends "base.html" %}

{% block titulo %}Creación de reportes{% endblock %}

{% block contenido %}
<div class="container mt-5">
  <h1 class="titulo-formulario">Creación de reporte</h1>

  <form class="formulario-reporte" action="/Inforise/crear" method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <!-- Nombre del reporte -->
    <div class="form-group mb-3">
      <label for="nombre_reporte">Nombre del reporte:</label>
      <input type="text" class="form-control" id="nombre_reporte" name="nombre_reporte" placeholder="Opcional">
    </div>

    <!-- Regional -->
    <div class="form-group mb-3">
      <label for="regional">Regional:</label>
      <input type="text" class="form-control" id="regional" name="regional" value="ATLÁNTICO">
    </div>

    <!-- Centro de formación -->
    <div class="form-group mb-3">
      <label for="centro_de_formacion">Centro de formación:</label>
      <select class="form-select" id="centro_de_formacion" name="centro_de_formacion" required>
        <option value="">Selecciona tu centro</option>
        {% for centro in centros %}
          <option value="{{ centro[0] }}">{{ centro[1] }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Programa de formación -->
    <div class="form-group mb-3">
      <label for="programa">Programa de formación:</label>
      <select class="form-select" id="programa" name="programa" required>
        <option value="">Selecciona tu programa</option>
        {% for programa in programas %}
          <option value="{{ programa[0] }}">{{ programa[1] }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Código del programa con tooltip -->
    <div class="form-group mb-3">
      <label for="codigo">Código del Programa:</label>
      <select class="form-select" id="codigo" name="codigo" required>
        <option value="">Selecciona el código</option>
        {% for programa in programas %}
          <option value="{{ programa[2] }}" title="{{ programa[1] }}">{{ programa[2] }}</option>
        {% endfor %}
      </select>
    </div>

    <h2 class="subtitulo-reporte">Identificación del ambiente de aprendizaje</h2>

    <!-- Localización -->
    <div class="form-group mb-3">
      <label for="localizacion">Localización del ambiente:</label>
      <input type="text" class="form-control" id="localizacion" name="localizacion" required>
    </div>

    <!-- Denominación -->
    <div class="form-group mb-3">
      <label for="denominacion">Denominación del ambiente:</label>
      <input type="text" class="form-control" id="denominacion" name="denominacion" required>
    </div>

    <!-- Tipo de ambiente -->
    <div class="form-group mb-3">
      <label class="mb-2">Tipo de ambiente:</label>
      <div class="tipo-opciones">
        {% for tipo in tipos %}
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="tipo" id="tipo_{{ loop.index }}" value="{{ tipo }}" required>
            <label class="form-check-label" for="tipo_{{ loop.index }}">{{ tipo }}</label>
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Botón -->
    <div class="d-flex justify-content-between mt-4">
      <button type="submit" class="btn btn-primary">Crear reporte</button>
    </div>
  </form>
</div>

<!-- JavaScript con Select2 y tooltips -->
<script>
$(document).ready(function () {
  // Inicializa Select2 en el campo de código
  $('#codigo').select2({
    placeholder: "Selecciona el código",
    width: 'resolve',
    templateResult: function (data) {
      if (!data.id) return data.text;
      const title = $(data.element).attr('title');
      const $result = $('<span></span>').text(data.text);
      if (title) $result.attr('title', title);
      return $result;
    },
    templateSelection: function (data) {
      return data.text;
    }
  });

  // Inicializa Select2 en otros campos si deseas
  $('#programa').select2({ placeholder: "Selecciona tu programa", width: 'resolve' });
  $('#centro_de_formacion').select2({ placeholder: "Selecciona tu centro", width: 'resolve' });

  // Convertir campos a mayúsculas automáticamente
  ['regional', 'localizacion', 'denominacion'].forEach(id => {
    const $campo = $('#' + id);
    $campo.on('input', function () {
      this.value = this.value.toUpperCase();
    });
  });
});
</script>
{% endblock %}
